#!/bin/bash

read -p "docker image: " dockerImage
dockerExPort=$(sed -rne 's/EXPOSE ([0-9]+)/\1/p' Dockerfile)
read -p "nginx config: " nginxConfig
read -p "remote host name: " hostName

cat <<EOF > deploy
#!/bin/bash
# Docker deploy script generated by deploy-make

[ -f ./.deploy-test ] && source ./.deploy-test
[ -f ./.deploy ] \
    || curl http://deployscript -o ./.deploy \
    || { echo "can't http the deployscript" ; exit 1; }
. \$0/.deploy
dockerImage=$dockerImage
dockerExPort=$dockerExPort
nginxConfig=$nginxConfig
hostName=$hostName
deploy \${1:-"deploy"} $dockerImage $dockerExPort $nginxConfig $hostName
EOF

chmod u+x deploy

echo deploy script has been written, now just bash deploy
